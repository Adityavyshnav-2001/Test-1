{%- doc -%}
  Renders a "Buy Now" button that adds the product to cart and redirects to checkout.
  This provides a quick checkout option for customers.

  @param {boolean} can_add_to_cart - Whether the product can be added to the cart.
  @param {object} product - The product object to be added to the cart.
  @param {string} [class] - Additional CSS classes to apply to the button.
  @param {string} [id] - The ID attribute for the button.
{%- enddoc -%}

{%- liquid
  assign default_buy_now_text = 'actions.buy_now' | t
-%}

<button
  {% if id != blank %}
    id="{{ id }}"
  {% endif %}
  type="submit"
  name="add"
  class="button buy-now-button {{ class }}"
  formaction="/cart/add"
  data-buy-now="true"
  {% unless can_add_to_cart %}
    disabled
  {% endunless %}
  onclick="
    event.preventDefault();
    const form = this.closest('form');
    const formData = new FormData(form);
    fetch('/cart/add.js', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      window.location.href = '/checkout';
    })
    .catch(error => {
      console.error('Error:', error);
    });
  "
>
  <span class="buy-now-text">
    <span class="buy-now-text__content">
      <span>
        {{- default_buy_now_text -}}
      </span>
    </span>
  </span>
</button>

{% stylesheet %}
  .buy-now-button {
    user-select: none;
    transition-property: color, box-shadow, background-color, scale, translate;
    transition-duration: var(--animation-speed);
    transition-timing-function: var(--ease-out-cubic);
    height: var(--height-buy-buttons);
    text-transform: var(--button-text-case-primary);
  }

  .buy-now-button:active {
    scale: 0.99;
    translate: 0 1px;
  }

  .buy-now-button.button-secondary {
    text-transform: var(--button-text-case-secondary);
  }

  .buy-now-text {
    display: flex;
    gap: var(--gap-2xs);
    align-items: center;
    justify-content: center;
  }
{% endstylesheet %}
